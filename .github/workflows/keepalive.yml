name: keepalive-ping

on:
  schedule:
    # GitHub Actions cron minimum granularity is ~5 minutes.
    - cron: '*/5 * * * *'
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    steps:
      - name: Ping backend health
        env:
          # Set these in GitHub repository "Variables" (Settings -> Secrets and variables -> Actions -> Variables)
          # Example: https://your-backend.example.com/health
          BACKEND_HEALTH_URL: ${{ vars.BACKEND_HEALTH_URL }}
          # Optional: ping python directly if itâ€™s publicly reachable
          PYTHON_HEALTH_URL: ${{ vars.PYTHON_HEALTH_URL }}
        run: |
          set -euo pipefail

          if [ -z "${BACKEND_HEALTH_URL:-}" ]; then
            echo "BACKEND_HEALTH_URL is not set (Actions Variable)."
            exit 1
          fi

          echo "Pinging backend: ${BACKEND_HEALTH_URL}"
          curl -fsS --max-time 20 "${BACKEND_HEALTH_URL}" > /dev/null

          if [ -n "${PYTHON_HEALTH_URL:-}" ]; then
            echo "Pinging python: ${PYTHON_HEALTH_URL}"
            curl -fsS --max-time 20 "${PYTHON_HEALTH_URL}" > /dev/null
          else
            echo "PYTHON_HEALTH_URL not set; skipping."
          fi
